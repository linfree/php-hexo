---
title: 用python分析了wh的药店
date: 2017-10-20 20:13:31
tags:
  - Python 
desc: python数据分析，武汉全部的药店数据
keywords: 数据分析 python 药店  
categories:
- Python

---


## 起因  
其实打算分析药店这个事情，与看完《我不是药神》没啥关系，取这个标题，只是为了蹭一波电影的热度。  
主要起因是，在世界杯期间看到一条段子：  
  
> 美国500米就有一个篮球场，巴西每个小区一个足球场，而中国500米就有个大药房。  

开始只是当成一个段子，觉得有夸张的嫌疑。但某天逛完超市回家，刻意的数了一下药店数量。  

** 震惊! 不到1km的路上居然有6，7个药店！真可怕。 **   

正好我最近刚开始学习python数据分析，于是，就决心以“超一线城市大武汉”为例，好好看看中国的药店到底多不多。  

## 数据获取

### 通过地图WebAPI  

我尝试着找了一下，好像网上没有现成的数据。   		
只能自己动手，搞点数据了。  

首先想到的是通过百度地图来获取数据，找了找，果然有相关的WebAPI。  

> 地点检索服务（又名Place API）是一类Web API接口服务；	 
> 服务提供多种场景的地点（POI）检索功能，包括城市检索、圆形区域检索、矩形区域检索。开发者可通过接口获取地点（POI）基础或详细地理信息。	

能直接通过WebAPI获取数据，连解析页面都省了，简直太爽了有木有？

本以为可以直接通过城市的检索的接口直接获取到我想要的数据。
然鹅，我错了，事情没我想的那么简单，这个api居然最多返回400条数据。大武汉的药店明显不止400个。我试着找了一下高德，高德更抠门，就200个结果。只能想想其他办法了。

### 切割地图

继续找其他的解决办法，忽然发现了地点检索api后面还有一个矩形区域检索功能。灵机一动，我可以把大武汉分成很多个小矩形，分块检索啊，这样也不会有数据丢失。		

想法很好，可当我看到武汉这长得像块‘三鲜豆皮’的地图的时候，问题又来了，我该怎么切割这个地图。  

![wh_map.jpg](https://i.loli.net/2018/07/30/5b5f15caa7de8.jpg)  

抱着不能错过一个，也不能浪费api资源的态度，我打算先找到武汉东南西北之最，也就是找到一个可以将武汉包裹的最小矩形。

想到了通过城市边界点筛选的方式获取武汉的最东，最南，最西，最北。结果找了半天没发现百度webapi里有这个，只有一个javascriptAPI有这个功能，比较麻烦。反倒是高德有个“行政区域查询”的api可以直接获取到城市边界。
```
http://restapi.amap.com/v3/config/district?key=您的key&keywords=武汉&subdistrict=0&extensions=all
```
接下来的事情就简单了，分析获取到的城市边界点列表，找到经纬度的最大最小值，即城市的最东南西北。然后从东到西切20刀，从南到北均匀切20刀。武汉一下就被切成400块了。  

我们就可以分块的去调用地点检索的API，如果有超过400个的，就调整参数，多切几刀。  

当然，这样切肯定有误伤周边城市的情况。这种情况就通过POI的“city”属性去筛选掉。

至此，我们就成功的获取到了我们想要的比较完整的药店的数据了。

### 其他数据  

有了药店的数据，我们还需要一些其他的数据，例如：行政区域面积啊，人口数量等。
像这类的数据，一般在当地的统计局网站都能下载到。 

## 数据分析

### 药店位置分布

我猜想，药店的数量应该与人口密度和地方经济情况有所关系。		

首先，我们通过图表看看武汉的人口密度：  
![武汉人口密度.png](https://i.loli.net/2018/08/01/5b61bd5f1e4d0.png)

从图像可以看出，人口密度最大的是江汉区，硚口区和武昌区，这些都是武汉的老城区。		
黄陂区，江夏，汉南这些都算是郊区，人口密度低，也情有可原。	
意外的是：主城区洪山区人口密度居然也不高。（可能统计面积的时候几个大湖也算进去了？）		

再看看，我们收集的药店的数据，我爬取的百度地图上能找到的武汉所有药店，一共爬到了1936个，估计还有一些没有收录到的遗漏了。在武汉药监局官网查到的药品零售企业有4317个，但这里可能又很多过期可但未注销的企业。所以这次我们以百度地图爬取到的数据为准。

首先我们看看各个区人数和药店数量的基本情况：		
![武汉各区人数和药店数.png](https://i.loli.net/2018/08/02/5b631261e4971.png)  

基本大多数的区药店数量都超过了1万人一个药店。	 

再看看武汉每个区的药店数量情况，武汉各个区域药店的数量占比：		
![武汉药店各区域占比.png](https://i.loli.net/2018/08/02/5b62d5e88df71.png)   

武昌、江岸、洪山、江汉这几个主城区果然还是占了大多的数的药店。

药店密度和人口密度是否有关呢？
![武汉各区多少人一个药店.png](https://i.loli.net/2018/08/01/5b61c3933b99d.png)

药店最密集的是江岸区，3408个人就有一个药店。而药店比较稀缺的新洲区居然平均26317个人才有一个药店，新洲区的朋友会不会有买药难的问题？

经济状况好的主城区人均药店数明显比郊区高。

光在表格上我们没办法形象的看到药店的分布，所以做成热力图更形象了。
![武汉药店热力分布图.png](https://i.loli.net/2018/08/01/5b61c590c5ae0.png)

### 药店店名分析


